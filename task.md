# Task.md

> 状态定义：`待进行` / `进行中` / `待确认` / `失败` / `完成`  
> 编号规则：`EPIC-*`（总任务）/ `TASK-*`（可执行任务），全局唯一，不复用。
> 任务编号不要随着完成的状态而改变。

## 进行中

| 新任务编号               | 原编号 | 任务名      | 优先级 | 状态  | 验收标准                                          | 备注                                                                                                                 |
| ------------------- | --- | -------- | --: | --- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| 暂无 | - | - | - | - | - | - |

## 待确认

| 新任务编号 | 原编号 | 任务名 | 优先级 | 状态 | 验收标准 | 备注 |
| --- | --- | --- | ---: | --- | --- | --- |
| 暂无 | - | - | - | - | - | - |

## 待进行（按优先级）

| 新任务编号                   | 原编号    | 任务名                 | 优先级 | 状态  | 验收标准                                                 | 备注                                        |
| ----------------------- | ------ | ------------------- | --: | --- | ---------------------------------------------------- | ----------------------------------------- |
| TASK-PERF-ANDROID-102   | P1-002 | Android 大批量选择首帧卡顿优化 |  P1 | 待进行 | 选择完成后 indexing 提示出现及时，用户无“卡死”误判。                     | 先优化首帧反馈                                   |
| TASK-PERF-ANDROID-104   | -      | Android 多选后索引与扫描提速  |  P1 | 待进行 | 同目录二次导入（>=300图）在安卓端索引+扫描总耗时明显下降（目标>=30%），并保持可读文件不误判。 | 与 `TASK-PERF-CACHE-101` 联动，优先优化索引阶段与解析并发。 |
| TASK-PERF-WIN-103       | P1-003 | Windows 大批量缩略图渲染优化  |  P1 | 待进行 | 滚动无明显掉帧，缩略图不反复重载。                                    | 首屏优先+分批渲染                                 |
| TASK-UX-PICKER-201      | P2-001 | 选择器提示文案             |  P2 | 待进行 | 用户可理解为“本地扫描”而非“上传”。                                  | 文案与入口一致                                   |
| TASK-FORMAT-HEIC-202    | P2-002 | HEIC/TIF 等格式支持      |  P2 | 待进行 | 可生成缩略图并可预览。                                          | 分平台逐步兼容                                   |
| TASK-MOBILE-GESTURE-203 | P2-003 | 移动端滑动切图             |  P2 | 待进行 | 左右滑动切换稳定，误触可控。                                       | Android/iOS                               |
| TASK-WIN-RESTORE-204    | P2-004 | Windows 预览返回保持滚动位置  |  P2 | 待进行 | 返回后位置保持，不触发整页缩略图重载。                                  | 网格状态保持                                    |
| TASK-UI-PANEL-301       | P3-001 | 竖屏设备信息面板改为底部弹出      |  P3 | 待进行 | 信息面板不遮挡主要画面。                                         | UI 优化                                     |
| TASK-UI-NAV-302         | P3-002 | 电脑端左右切图按钮自动淡入淡出     |  P3 | 待进行 | 鼠标移动显示、静止自动隐藏。                                       | UI 优化                                     |
| TASK-UI-THEME-303       | P3-003 | 深色/浅色模式跟随系统         |  P3 | 待进行 | 主题可跟随系统切换。                                           | UI 优化                                     |
| TASK-UI-VIDEO-304       | P3-004 | 视频预览能力与图片交互一致       |  P3 | 待进行 | 视频与图片交互一致（缩放/位置/切图）。                                 | 体验一致性                                     |

## 失败

| 新任务编号 | 原编号 | 任务名 | 优先级 | 状态 | 验收标准 | 阻塞原因/下一步 |
|---|---|---|---:|---|---|---|
| 暂无 | - | - | - | - | - | - |

## 完成

| 新任务编号                     | 原编号       | 任务名                                 | 优先级 | 状态  | 验收标准                                                                                                                       | 备注                                                                  |
| ------------------------- | --------- | ----------------------------------- | --: | --- | -------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------- |
| EPIC-LIVE-ROBUST-001      | P0-001    | 通用 Live 播放鲁棒性（总任务）                  |  P0 | 完成  | 子任务 `TASK-LIVE-STATE-002`、`TASK-LIVE-A-006`、`TASK-LIVE-B-007`、`TASK-LIVE-B-008`、`TASK-LIVE-B-010`、`TASK-LIVE-RG-009` 全部通过。 | 用户确认完成；主线收口。                                                        |
| TASK-LIVE-STATE-002       | P0-001-02 | 播放状态机收敛（original -> stripped）       |  P0 | 完成  | 同一轮播放只允许一次回退；无双重回退、无黑屏闪烁、无重复 `play reject`。                                                                                | 基于 `docs/temp.md` 日志2核验：`fallback join` 生效，三样本 `live ended` 闭环。     |
| TASK-DOC-HANDOFF-401      | -         | AI 接手文档完善（单文档可快速上手）                 |  P1 | 完成  | 新 AI 在不翻历史聊天的情况下，可据文档完成：运行、定位播放链路、执行回归、识别当前风险点。                                                                            | 用户确认完成，可用于后续 AI 冷启动接手。                                              |
| TASK-LIVE-BASELINE-001    | P0-001-01 | 复现矩阵与基线采集                           |  P0 | 完成  | 固定样本（vivo/xiaomi/honor）在 Android Edge/Android Chrome 各跑一轮，沉淀对照日志。                                                          | 已获用户确认通过                                                            |
| TASK-LIVE-A-003           | P0-001-03 | A1：引入 `exifr` 并统一 Live 元数据解析层       |  P0 | 完成  | vivo/xiaomi/honor 样本元数据解析结构统一，输出字段稳定（make/model/motion tags/offset）。                                                       | 用户确认通过                                                              |
| TASK-LIVE-A-004           | P0-001-04 | A2：引入 `mediainfo.js` 媒体轨道探测         |  P0 | 完成  | 能稳定识别音轨/视频轨/编码信息，播放前可得到能力输入。                                                                                               | 用户确认可见 `[track-probe]` 输出                                           |
| TASK-LIVE-A-005           | P0-001-05 | A3：引入 `mp4box.js` 做去音轨/重组           |  P0 | 完成  | 替代手写 strip 主链路；输出 MP4 在主流浏览器可重复播放。                                                                                         | 用户确认可见 `[mp4box]` 输出                                                |
| TASK-LIVE-A-006           | P0-001-06 | A4：通用播放决策链路（original -> sanitized）  |  P0 | 完成  | 不依赖浏览器名硬编码，按能力+运行时错误决定回退路径。                                                                                                | Android 日志显示 `fallback join` 生效且三样本均可 `live ended`。                 |
| TASK-LIVE-B-007           | -         | B1：接入 `ffmpeg.wasm` 作为重兜底           |  P0 | 完成  | 仅在 A 链路失败时触发，保证最差情况下仍可播放（允许静音降级）。                                                                                          | Windows Chrome 回归通过：`b_force` 三厂商可播，busy-stuck 可自动恢复；auto 链路有声验证通过。 |
| TASK-LIVE-B-008           | -         | B2：兜底链路性能与缓存治理                      |  P0 | 完成  | 懒加载、超时、取消、结果缓存可用；不会拖垮首帧体验。                                                                                                 | 自动化验收通过：缓存上限/LRU/重扫清理/并发去重/首帧对比均满足当前口径。                             |
| TASK-LIVE-B-010           | -         | B3：A链路失败自动切换到B链路                    |  P0 | 完成  | 当 A 链路原始源与 sanitized 源均失败时，自动触发 ffmpeg B 链路并完成可播放（允许静音）；不需要手动切换 `b_force`。                                                 | Windows + Android Chrome/Edge 自动化回归通过，用户手工验收确认完成。                   |
| TASK-LIVE-RG-009          | -         | 多浏览器回归验证与验收清单                       |  P0 | 完成  | Android/Windows 主流浏览器 + 三厂商样本形成可复现验收表。                                                                                     | 用户确认完成；回归矩阵已收口。                                                     |
| TASK-UI-STATS-201         | P1-004    | 修复 stats UI 乱码                      |  P1 | 完成  | `#stats` 显示 `总计 X · Live Y · 已选 Z`，筛选/选择变化时无乱码。                                                                            | 相关文件：`src/js/app.js`                                                |
| TASK-DETECT-HONOR-202     | DONE-001  | 荣耀 Live 大文件夹漏检修复                    |  P1 | 完成  | 漏检问题已修复并通过回归。                                                                                                              | -                                                                   |
| TASK-SCAN-PLACEHOLDER-203 | DONE-002  | 索引阶段支持提前生成全部占位符                     |  P1 | 完成  | indexing 阶段可提前生成占位符。                                                                                                       | -                                                                   |
| TASK-ARCH-STRUCTURE-204   | DONE-003  | 项目结构迁移（`index.html + src + vendor`） |  P1 | 完成  | 模块化结构落地。                                                                                                                   | -                                                                   |
| TASK-PERF-SCAN-205        | DONE-004  | 扫描速度重构（后台渐进扫描 + 分批渲染）               |  P1 | 完成  | 扫描与渲染链路重构完成。                                                                                                               | -                                                                   |
| TASK-ANDROID-PICKER-206   | DONE-005  | Android 默认改为多选文件策略                  |  P1 | 完成  | 安卓策略切换完成。                                                                                                                  | -                                                                   |
| TASK-PERF-CACHE-101       | P1-001    | 扫描结果缓存策略                           |  P1 | 完成  | 二次加载同目录明显更快，缓存体积可控。                                                                                                          | 用户确认完成；编号保持 `TASK-PERF-CACHE-101` 不变。                                         |
| TASK-PERF-THUMB-105       | -         | 缩略图持久化缓存                           |  P1 | 完成  | 同目录二次导入与刷新后，缩略图优先命中持久化缓存；首屏缩略图生成耗时下降，且缓存体积受控。                                                                            | 用户确认完成；已落地 IndexedDB+LRU、并发去重、坏缓存回退、容量调优与启动恢复日志。                                  |
| TASK-SORT-305             | P3-005    | 默认排序改为拍摄时间（新 -> 旧）                 |  P3 | 完成  | 默认排序符合拍摄时间新到旧。                                                                                                              | 用户确认完成；默认键 `shot_desc` 已落地并通过回归。                                           |

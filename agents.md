# Agents.md

## 1) 项目目标与用途
- 项目：`live-photo-viewer`
- 目标：离线扫描本地图片，识别 Live Photo，并提供稳定预览/播放。
- 重点场景：Android/Windows 大量文件扫描、跨浏览器（Chrome/Edge）播放兼容。

## 2) 三个流程文件（唯一来源）
- `agents.md`：项目目标、开发规范、可复用经验。
- `task.md`：任务池与状态（待进行 / 进行中 / 待确认 / 失败 / 完成）。
- `progress.md`：每轮任务摘要与验证证据。

## 3) 标准开发步骤（必须执行）
1. 领取一个任务（从 `task.md` 选择，默认按优先级）。
2. 开始编码（仅改任务相关文件，保持最小改动）。
3. 测试验证（给出可复现步骤 + 关键日志/可观察结果）。
4. 更新任务状态：
   - 成功：`进行中 -> 待确认`（用户确认后再 `完成`）
   - 失败：`进行中 -> 失败`（记录阻塞点和下一步）
   - 同时把本轮摘要写入 `progress.md`
5. 提交代码：每一小步可回滚，commit message 包含任务名/任务ID。

## 4) 强约束
- 一轮只做一个任务。
- 没有验证证据，不得标记完成。
- 每轮结束必须更新 `progress.md` 和 `task.md`。

## 5) 可复用经验（当前项目）
- Android Edge 与 Chrome 同为 Chromium，但媒体管线策略可能不同；AAC 轨道在 Edge 可能触发 demux 错误。
- Live 播放回退策略建议：`original -> stripped`，并记录 `[live-debug]` 关键日志。
- 对 `<video>` 反复切源需做并发防抖（会话 token + 回退去重），否则可能出现 `play() interrupted by pause()`。
- 大目录扫描采用“先占位后渐进识别”能显著改善可用性。

## 6) 新问题处理规则
- 开发中发现新问题：不插队；写入 `task.md`（或在 `progress.md` 先记录，再回填任务）。
- 高优问题可由用户显式指定插队。

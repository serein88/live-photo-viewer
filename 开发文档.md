# Live 图查看器开发文档（模块化项目）

## 1. 项目目标
- 目标：在本地离线环境中扫描图片/视频，识别 Live Photo，并提供相册式浏览与导出。
- 平台：Windows、Android、iOS（含 Safari 降级路径）。
- 当前原则：从“单文件 HTML”迁移为“常规前端项目结构”，提升可维护性与协作效率。

## 2. 架构决策
- 放弃单文件交付作为主分支形态，改为模块化文件组织。
- 运行时依然是纯前端静态页面，不依赖后端服务。
- 第三方库（Viewer.js）保持独立 vendor 目录，不再内联到 `index.html`。

## 3. 当前目录结构
```text
live-photo-viewer/
├─ index.html                # 页面入口，仅保留 DOM 结构与资源引用
├─ src/
│  ├─ css/
│  │  └─ app.css             # 业务样式（原内联 style）
│  └─ js/
│     └─ app.js              # 业务逻辑（原内联 script）
├─ vendor/
│  ├─ viewer.min.css         # 第三方样式
│  └─ viewer.min.js          # 第三方脚本
├─ tools/
│  └─ mcp-pack.ps1           # MCP 打包工具
├─ agents.md                 # 开发日志（交接记录）
└─ 开发文档.md               # 本文档
```

## 4. 关键模块职责
- `index.html`
  - 承载语义化结构与基础控件。
  - 只负责资源装配：`vendor/*` + `src/*`。
- `src/css/app.css`
  - 维护主题变量、网格、预览器 UI、响应式布局。
  - 不放业务逻辑，仅保留样式层定义。
- `src/js/app.js`
  - 文件导入、目录选择、扫描识别、EXIF 解析、Viewer 交互。
  - 目录选择按平台分流：
    - Windows/桌面：优先 `showDirectoryPicker`
    - Android/兼容浏览器：`webkitdirectory` 方案
    - iOS：降级为多文件选择

## 5. 开发与调试约定
- 本地启动：使用任意静态服务器打开项目根目录。
- 调试重点日志：
  - 目录导入链路：`[dir-pick] ...`
  - 预览布局链路：`[viewer] ...`
- 提交前最小检查：
  - 页面可加载（无 404 资源）
  - 目录导入可触发扫描
  - 预览打开、切图、Live 播放/静音可用

## 6. 项目管理方法（执行版）
- 分支策略（推荐）
  - `main`：稳定可用
  - `feature/*`：功能开发
  - `fix/*`：问题修复
- 变更粒度
  - UI、识别、导出、平台兼容分别提交，避免“大杂烩提交”。
- 日志规范
  - 每次需求完成后，必须同步 `agents.md`：背景、改动、风险、待办。
- 文档同步
  - 有架构调整时先改 `开发文档.md`，再动代码。

## 7. 后续拆分计划（建议按优先级）
1. 把 `src/js/app.js` 继续拆分：
   - `platform.js`（平台检测与目录导入）
   - `scanner.js`（扫描/识别）
   - `viewer.js`（预览交互）
   - `exif.js`（EXIF 解析）
2. 引入 `docs/` 目录：
   - `docs/ROADMAP.md`（阶段计划）
   - `docs/CHANGELOG.md`（版本变更）
3. 增加基础质量门禁：
   - `tools/check.ps1`（静态检查入口）

## 8. 风险与注意事项
- iOS 无法稳定支持文件夹 API，必须保留多文件降级路径。
- Live 格式存在厂商变体，识别逻辑需要可扩展，不要硬编码散落。
- 大量文件扫描时要避免阻塞主线程，继续保持分批处理策略。

## 9. 最新状态（2026-02-10）
- 已完成：从单文件入口迁移为常规结构（`index.html + src/css + src/js + vendor`）。
- 已完成：目录导入按平台分流，含调试日志。
- 待继续：进一步按职责拆分 `app.js`，并补充项目级 `docs` 与质量门禁脚本。

